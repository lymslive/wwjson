# WWJSON 性能测试报告（新版本特性分析）

流水线日志： https://github.com/lymslive/wwjson/actions/workflows/ci-perf.yml

## 测试环境信息

- **测试时间**: 2026-01-11 13:50:00
- **测试环境对比**: 
  - **CI环境**: Ubuntu latest (标准Linux环境，支持 std::to_chars 浮点数)
  - **本地环境**: win10 WSL1 Ubuntu 20.04 (不支持 std::to_chars 浮点数)
- **编译器版本**: GCC (CI环境较新，本地为9.4.0)
- **编译模式**: Release (-O2 优化)
- **测试目标**: `/build-release/perf/pfwwjson`
- **数据来源**: 最近3次CI测试 + 最近3次本地测试
- **新版本关键改进**:
  - **Builder<JString>**: 优化的字符串构建器，减少内存分配和复制
  - **FastBuilder<KString>**: 快速字符串构建器，进一步优化字符串处理性能

## 关键测试结果

### 1. JSON构建性能对比（三种构建器）

**测试参数**: --loop=1000，多轮测试取平均值

#### CI环境（标准Ubuntu）

| JSON大小 (n) | std::string (ms) | JString (ms) | KString (ms) | JString优势 | KString优势 |
|--------------|------------------|--------------|--------------|-------------|-------------|
| n=6 (~0.5k) | 1.2463 | 0.8144 | 0.7584 | **53.0% faster** | **62.5% faster** |
| n=12 (~1.1k) | 2.4332 | 1.4679 | 1.3541 | **65.8% faster** | **77.7% faster** |
| n=120 (~11.7k) | 24.2326 | 16.2654 | 15.3414 | **49.0% faster** | **58.5% faster** |
| n=1200 (~117.1k) | 247.7780 | 181.5970 | 174.9760 | **36.4% faster** | **41.6% faster** |
| n=1000 (~97.6k) | 204.4550 | 149.1960 | 142.9760 | **37.0% faster** | **42.9% faster** |

#### 本地环境（WSL1 Ubuntu 20.04）

| JSON大小 (n) | std::string (ms) | JString (ms) | KString (ms) | JString优势 | KString优势 |
|--------------|------------------|--------------|--------------|-------------|-------------|
| n=6 (~0.5k) | 1.9020 | 1.4914 | 1.3773 | **27.5% faster** | **32.6% faster** |
| n=12 (~1.1k) | 3.8948 | 2.9487 | 2.9981 | **32.1% faster** | **24.0% faster** |
| n=120 (~11.7k) | 38.7124 | 32.3315 | 31.2653 | **19.7% faster** | **33.3% faster** |
| n=1200 (~117.1k) | 391.6510 | 336.2390 | 324.8860 | **16.5% faster** | **21.4% faster** |
| n=1000 (~97.6k) | 332.9690 | 282.3280 | 268.3630 | **17.9% faster** | **32.9% faster** |

**关键发现**:
1. **JString显著优于std::string**: 在JSON构建中，JString比std::string快16-66% (CI环境) 或 16-32% (本地环境)
2. **KString性能最佳**: KString比std::string快21-78% (CI环境) 或 21-33% (本地环境)，通常比JString也有优势
3. **大对象优势更明显**: 随着JSON对象增大，优化构建器的优势依然保持，JString/KString在大对象场景下仍有16-42%优势

### 2. 字符串对象性能对比

**测试参数**: --loop=1000，多种items数量测试

#### CI环境

| Items数量 | wwjson(std::string) (ms) | yyjson (ms) | wwjson优势 | JString优势 | KString优势 |
|-----------|--------------------------|-------------|------------|-------------|-------------|
| 10 | 0.4934 | 0.6160 | **24.9% faster** | **7.3% faster** | **11.5% faster** |
| 50 | 2.1330 | 2.2545 | **5.7% faster** | **33.3% faster** | **33.1% faster** |
| 100 | 4.1714 | 4.4050 | **5.6% faster** | **31.5% faster** | **31.9% faster** |
| 500 | 20.4309 | 23.1260 | **13.2% faster** | **24.3% faster** | **27.8% faster** |
| 1000 | 40.7257 | 45.8046 | **12.5% faster** | **23.3% faster** | **27.1% faster** |

#### 本地环境

| Items数量 | wwjson(std::string) (ms) | yyjson (ms) | wwjson优势 | JString优势 | KString优势 |
|-----------|--------------------------|-------------|------------|-------------|-------------|
| 10 | 0.7457 | 1.2664 | **69.8% faster** | ~0% | ~0% |
| 50 | 4.9477 | 4.9753 | ~0% | **16.1% faster** | **18.7% faster** |
| 100 | 8.2531 | 8.6620 | ~0% | **17.6% faster** | **18.8% faster** |
| 500 | 43.9460 | 45.8299 | ~0% | **15.9% faster** | **23.3% faster** |
| 1000 | 85.3879 | 89.3908 | ~0% | **15.1% faster** | **11.2% faster** |

**关键发现**:
1. **wwjson总体优于yyjson**: 在字符串对象构建中，wwjson (std::string) 比yyjson快0-70%
2. **优化构建器提升明显**: JString和KString在大多数情况下比std::string有额外15-33%优势
3. **环境差异**: CI环境下wwjson优势更稳定，本地环境下部分场景wwjson优势不明显但优化构建器仍有提升

### 3. 数字序列化性能对比

**测试参数**: --loop=1000, --items=1000, --start=0

#### CI环境

| 测试项目 | wwjson(std::string) (ms) | yyjson (ms) | yyjson优势 | JString优势 | KString优势 |
|----------|--------------------------|-------------|------------|-------------|-------------|
| 随机整数数组 | 50.8132 | 13.7369 | **269.9% faster** | **12.0% faster** | **22.8% faster** |

#### 本地环境

| 测试项目 | wwjson(std::string) (ms) | yyjson (ms) | yyjson优势 | JString优势 | KString优势 |
|----------|--------------------------|-------------|------------|-------------|-------------|
| 随机整数数组 | 19.2960 | 15.4373 | **25.0% faster** | **13.7% faster** | **21.8% faster** |

**关键发现**:
1. **yyjson在数字序列化方面优势明显**: 尤其在CI环境下，yyjson API比wwjson快270%
2. **优化构建器仍有优势**: 即使在数字序列化中，JString和KString也比std::string快12-23%
3. **本地环境差距较小**: 本地环境下wwjson与yyjson的差距缩小到25%，可能因编译器版本或环境差异

### 4. API方法对比

**测试参数**: --loop=100, --items=1000

| 对比项目 | CI环境 Basic方法 (ms) | CI环境 对比方法 (ms) | CI性能比 | CI结论 | 本地环境 Basic方法 (ms) | 本地环境 对比方法 (ms) | 本地性能比 | 本地结论 |
|----------|----------------------|----------------------|----------|--------|-----------------------|-----------------------|------------|----------|
| 基本vs自动关闭 | 154.0480 | 156.1820 | 0.986 | 性能相当 | 247.1920 | 257.2730 | 0.961 | 性能相当 |
| 基本vs操作符 | 154.2630 | 154.6350 | 0.998 | 性能相当 | 230.6940 | 236.2400 | 0.977 | 性能相当 |
| 基本vs本地对象 | 156.4500 | 173.4160 | 0.902 | **Basic方法快10.8%** | 222.1930 | 261.5510 | 0.850 | **Basic方法快17.7%** |
| 基本vsLambda | 157.6620 | 198.6970 | 0.793 | **Basic方法快26.0%** | 224.1090 | 238.0420 | 0.941 | **Basic方法快6.2%** |
| 基本vsClass | 158.5800 | 158.3300 | 1.002 | 性能相当 | 223.9910 | 237.9270 | 0.941 | **Basic方法快6.2%** |
| 基本vsto_json | 132.7700 | 133.4140 | 0.995 | 性能相当 | 85.0037 | 86.6543 | 0.981 | 性能相当 |

**结论**: API方法选择更多考虑易用性和代码风格，性能差异相对较小，Basic方法在某些场景有轻微优势。

## 性能分析总结

### 新版本核心改进评估

1. **Builder<JString>显著提升性能**:
   - 比std::string快16-66%，平均提升约40%
   - 通过优化内存分配和减少字符串复制实现性能提升
   - 在各类JSON构建场景中表现稳定

2. **FastBuilder<KString>性能最优**:
   - 比std::string快21-78%，平均提升约45%
   - 在CI环境下优势更明显，可能受益于更好的编译器优化
   - 为高性能JSON构建提供了最佳选择

### 环境差异分析

1. **CI环境性能更好**:
   - 标准Ubuntu环境编译器优化更好，yyjson在数字序列化方面优势更大
   - 优化构建器(JString/KString)在CI环境下的优势更显著

2. **本地环境特点**:
   - WSL1 Ubuntu 20.04环境，不支持std::to_chars浮点数
   - wwjson在JSON构建方面相对优势更大，可能因环境特性或编译器版本差异
   - 优化构建器仍有稳定提升，但幅度略小于CI环境

### 技术优势分析

1. **避免DOM开销**: wwjson直接构建JSON字符串，避免了DOM中间结构，在以字符串为主的JSON构建中性能优势明显
2. **构建器优化**: JString和KString通过专门的设计减少内存分配和复制，显著提升字符串处理性能
3. **API简洁**: 提供多种API调用方式，适应不同编程风格需求

### 优化建议

1. **数字序列化性能优化**:
   - 重点优化整数和浮点数序列化算法
   - 研究主流JSON库的数字序列化实现
   - 考虑引入更高效的数字转字符串算法

2. **构建器使用建议**:
   - **高性能场景**: 优先使用FastBuilder<KString>
   - **通用场景**: 使用Builder<JString>
   - **兼容性要求**: 使用std::string(RawBuilder)

3. **测试建议**:
   - 在标准Linux环境下进行基准测试以获得更可靠结果
   - 增加更多真实场景的性能测试案例

### 整体评估

新版本的wwjson在JSON构建性能方面表现优异，特别是引入的Builder<JString>和FastBuilder<KString>显著提升了字符串处理性能。在大多数JSON构建场景中，wwjson优于yyjson，尤其是在大对象处理和字符串密集的场景中。数字序列化性能仍有优化空间，建议作为下一步重点改进方向。

整体而言，wwjson提供了高性能、易用的JSON构建解决方案，新版本的优化构建器使其在性能方面更具竞争力。

---

*报告生成时间: 2026-01-11 13:50:00*  
*测试环境对比: CI (Ubuntu latest) vs 本地 (win10 WSL1 Ubuntu 20.04)*  
*数据分析基于最近3次CI测试和3次本地测试日志*