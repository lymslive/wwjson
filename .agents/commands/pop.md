---
description: "分析、规划并完成一个 TODO 开发需求"
---

## 需求获取

需求内容可用脚本从 `task_todo.md` 读取

```bash
!perl .tool/todo.pl $1
```

脚本支持使用特定需求 ID 作为参数，或使用 -1 自动查找最后一个未完成的需求。
需求 ID 在二级标题处，格式是 `yyyy-mm-dd/n` 。

## 实施阶段

- 先仔细分析用户需求内容，评估可行性与合理性。
- 如果任务较复杂，请先将实施计划写入 `doing_plan.tmp/` 子目录，确认后再开始。
- 如果评估为不合理需求，或者理解的需求不明确，可以再与用户沟通确认。
- 如果自动 debug 陷入循环 5 次以上仍未能解决问题，可以放弃与终止任务，汇报当前进度。

## 收尾阶段

由当前时间生成任务 ID ，格式为 `yyyymmdd-hhmmss` ，可用 `date +"%Y%m%d-%H%M%S"` 命令。

以任务 ID 为二级标题在 `task_log.md` 末尾追加式作日志，参考已有格式。
- 可读取原日志文件前 100 行与后 100 行作为参考；
- 或用 `perl .tool/tlog.pl` 准确提取最后一条日志记录，也支持参数读最后 `n` 条；
- 注意只能追加到原文件末尾，不要覆盖原文件或修改中间原有内容；
- 可以先覆盖式写入 `last_log.md` 临时文件，末尾加一空行；
  再用命令 `cat last_log.md >> task_log.md` 追加日志。

再将任务 ID 写回 `task_todo.md` 关联需求 ID，
可用脚本命令更新： `perl .tool/todo.pl "需求ID" "任务ID"`

## 提交阶段

最后将当前修改提交 git ，提交消息格式按常见的 `type(scope):` 规范前缀，
- scope 为当前需求 ID
- 消息正文件可用英文，描叙主要变更
- 例行修改的 task_todo.md 与 task_log.md 没必要体现在提交消息

注意：最后的提交必须经用户确认。

